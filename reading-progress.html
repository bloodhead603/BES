<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Progress - Phil-IRI Based</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4e73df;
            --secondary: #6f42c1;
            --success: #1cc88a;
            --info: #36b9cc;
            --warning: #f6c23e;
            --danger: #e74a3b;
            --light: #f8f9fc;
            --dark: #5a5c69;
        }
        
        body {
            background-color: #f8f9fc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary) 10%, var(--secondary) 100%);
            height: 100vh;
            position: fixed;
            color: white;
            padding-top: 20px;
            width: 250px;
            overflow-y: auto;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 15px 20px;
            margin: 5px 0;
            border-radius: 5px;
        }
        
        .sidebar .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: bold;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        
        .header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid #e3e6f0;
            font-weight: bold;
            color: var(--dark);
        }
        
        .progress {
            height: 20px;
            border-radius: 10px;
        }
        
        .reading-level {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .level-independent {
            background-color: #d4edda;
            color: #155724;
        }
        
        .level-instructional {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .level-frustration {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .phil-iri-guide {
            background: linear-gradient(45deg, #4e73df, #6f42c1);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .guide-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .guide-independent {
            background-color: rgba(25, 135, 84, 0.2);
            border-left: 5px solid #198754;
        }
        
        .guide-instructional {
            background-color: rgba(255, 193, 7, 0.2);
            border-left: 5px solid #ffc107;
        }
        
        .guide-frustration {
            background-color: rgba(220, 53, 69, 0.2);
            border-left: 5px solid #dc3545;
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .main-content {
                margin-left: 0;
            }
        }

        .student-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar d-md-block">
                <div class="text-center mb-4">
                    <h4><i class="fas fa-book-reader me-2"></i>Reading Tracker</h4>
                    <p class="text-white-50 small">Grade 5 Phil-IRI Monitoring</p>
                </div>
                
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="fas fa-home me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="students.html">
                            <i class="fas fa-user-graduate me-2"></i>Students
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="reading-progress.html">
                            <i class="fas fa-chart-line me-2"></i>Reading Progress
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="assessments.html">
                            <i class="fas fa-file-alt me-2"></i>Assessments
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="leaderboard.html">
                            <i class="fas fa-trophy me-2"></i>Leaderboard
                        </a>
                    </li>
                </ul>
                
                <div class="mt-5 text-center">
                    <div class="card bg-light text-dark">
                        <div class="card-body py-3">
                            <h6>Phil-IRI Guide</h6>
                            <p class="small mb-0">Independent: 97-100% WR, 80-100% Comp</p>
                            <p class="small mb-0">Instructional: 90-96% WR, 59-79% Comp</p>
                            <p class="small">Frustration: Below 90% WR, Below 59% Comp</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content">
                <!-- Header -->
                <div class="header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0"><i class="fas fa-chart-line me-2 text-primary"></i>Reading Progress Analysis</h4>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary" id="refreshData"><i class="fas fa-sync-alt me-1"></i>Refresh</button>
                    </div>
                </div>
                
                <!-- Phil-IRI Guide -->
                <div class="phil-iri-guide">
                    <h5><i class="fas fa-info-circle me-2"></i>Phil-IRI Reading Level Guide</h5>
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="guide-item guide-independent">
                                <h6>Independent Level</h6>
                                <p class="mb-0">Word Recognition: 97-100%</p>
                                <p class="mb-0">Comprehension: 80-100%</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="guide-item guide-instructional">
                                <h6>Instructional Level</h6>
                                <p class="mb-0">Word Recognition: 90-96%</p>
                                <p class="mb-0">Comprehension: 59-79%</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="guide-item guide-frustration">
                                <h6>Frustration Level</h6>
                                <p class="mb-0">Word Recognition: Below 90%</p>
                                <p class="mb-0">Comprehension: Below 59%</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Row -->
                <div class="row">
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Students</div>
                                <div class="stat-number" id="total-students">24</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Independent Readers</div>
                                <div class="stat-number" id="independent-readers">8</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Instructional Level</div>
                                <div class="stat-number" id="instructional-readers">10</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Frustration Level</div>
                                <div class="stat-number" id="frustration-readers">6</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Progress Overview -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="m-0 font-weight-bold">Reading Progress Overview</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="progressChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="m-0 font-weight-bold">Reading Level Distribution</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="levelChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Student Progress -->
                <div class="row mt-4">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="m-0 font-weight-bold">Top Readers</h6>
                            </div>
                            <div class="card-body">
                                <div class="list-group">
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="student-avatar">MR</div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0">Maria Reyes</h6>
                                            <small class="text-muted">Word Recognition: 98% | Comprehension: 92%</small>
                                        </div>
                                        <span class="reading-level level-independent">Independent</span>
                                    </div>
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="student-avatar">JS</div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0">Juan Santos</h6>
                                            <small class="text-muted">Word Recognition: 97% | Comprehension: 88%</small>
                                        </div>
                                        <span class="reading-level level-independent">Independent</span>
                                    </div>
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="student-avatar">AP</div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0">Ana Perez</h6>
                                            <small class="text-muted">Word Recognition: 96% | Comprehension: 82%</small>
                                        </div>
                                        <span class="reading-level level-independent">Independent</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="m-0 font-weight-bold">Students Needing Support</h6>
                            </div>
                            <div class="card-body">
                                <div class="list-group">
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="student-avatar">JD</div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0">Jose Dela Cruz</h6>
                                            <small class="text-muted">Word Recognition: 85% | Comprehension: 45%</small>
                                        </div>
                                        <span class="reading-level level-frustration">Frustration</span>
                                    </div>
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="student-avatar">MG</div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0">Miguel Garcia</h6>
                                            <small class="text-muted">Word Recognition: 88% | Comprehension: 52%</small>
                                        </div>
                                        <span class="reading-level level-frustration">Frustration</span>
                                    </div>
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="student-avatar">SL</div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0">Sofia Lopez</h6>
                                            <small class="text-muted">Word Recognition: 92% | Comprehension: 58%</small>
                                        </div>
                                        <span class="reading-level level-instructional">Instructional</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Progress by Category -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h6 class="m-0 font-weight-bold">Progress by Reading Category</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Word Recognition Progress</h6>
                                <div class="progress mb-3" style="height: 20px;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 33%;" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">Independent 33%</div>
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 42%;" aria-valuenow="42" aria-valuemin="0" aria-valuemax="100">Instructional 42%</div>
                                    <div class="progress-bar bg-danger" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Frustration 25%</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6>Comprehension Progress</h6>
                                <div class="progress mb-3" style="height: 20px;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 30%;" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">Independent 30%</div>
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100">Instructional 45%</div>
                                    <div class="progress-bar bg-danger" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Frustration 25%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Monthly Progress -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h6 class="m-0 font-weight-bold">Monthly Progress Trend</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="monthlyProgressChart" height="100"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize charts
        document.addEventListener('DOMContentLoaded', function() {
            // Progress Chart
            const progressCtx = document.getElementById('progressChart').getContext('2d');
            const progressChart = new Chart(progressCtx, {
                type: 'line',
                data: {
                    labels: ['August', 'September', 'October', 'November'],
                    datasets: [{
                        label: 'Class Average - Word Recognition',
                        data: [75, 82, 88, 91],
                        borderColor: '#4e73df',
                        tension: 0.3,
                        fill: false
                    }, {
                        label: 'Class Average - Comprehension',
                        data: [65, 74, 79, 83],
                        borderColor: '#1cc88a',
                        tension: 0.3,
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 50,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Percentage (%)'
                            }
                        }
                    }
                }
            });
            
            // Level Distribution Chart
            const levelCtx = document.getElementById('levelChart').getContext('2d');
            const levelChart = new Chart(levelCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Independent', 'Instructional', 'Frustration'],
                    datasets: [{
                        data: [8, 10, 6],
                        backgroundColor: ['#1cc88a', '#f6c23e', '#e74a3b'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw} students`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Monthly Progress Chart
            const monthlyCtx = document.getElementById('monthlyProgressChart').getContext('2d');
            const monthlyChart = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: ['August', 'September', 'October', 'November'],
                    datasets: [{
                        label: 'Independent',
                        data: [4, 5, 7, 8],
                        backgroundColor: '#1cc88a'
                    }, {
                        label: 'Instructional',
                        data: [12, 11, 10, 10],
                        backgroundColor: '#f6c23e'
                    }, {
                        label: 'Frustration',
                        data: [8, 8, 7, 6],
                        backgroundColor: '#e74a3b'
                    }]
                },
                options: {
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Number of Students'
                            }
                        }
                    }
                }
            });
            
            // Refresh data button
            document.getElementById('refreshData').addEventListener('click', function() {
                // Simulate data refresh
                const independent = Math.floor(Math.random() * 5) + 6;
                const instructional = Math.floor(Math.random() * 5) + 8;
                const frustration = 24 - independent - instructional;
                
                document.getElementById('independent-readers').textContent = independent;
                document.getElementById('instructional-readers').textContent = instructional;
                document.getElementById('frustration-readers').textContent = frustration;
                
                // Update charts with new data
                levelChart.data.datasets[0].data = [independent, instructional, frustration];
                levelChart.update();
                
                // Show notification
                alert('Data refreshed successfully!');
            });
        });
        
        // Function to get students and assessments from localStorage (shared across pages)
        function getStudents() {
            return JSON.parse(localStorage.getItem('grade5ReadingTracker_students')) || [];
        }
        function getAssessments() {
            return JSON.parse(localStorage.getItem('grade5ReadingTracker_assessments')) || [];
        }

        // Function to update dashboard stats (call this in all pages that show these stats)
        function updateDashboardStats() {
            const students = getStudents();
            const assessments = getAssessments();

            // Count by reading level (based on latest assessment per student)
            let independentCount = 0;
            let instructionalCount = 0;
            let frustrationCount = 0;

            students.forEach(student => {
                // Find latest assessment for this student
                const studentAssessments = assessments.filter(a => a.studentId === student.id);
                if (studentAssessments.length > 0) {
                    const latest = studentAssessments.reduce((a, b) => new Date(a.date) > new Date(b.date) ? a : b);
                    if (latest.readingLevel === 'Independent') independentCount++;
                    else if (latest.readingLevel === 'Instructional') instructionalCount++;
                    else if (latest.readingLevel === 'Frustration') frustrationCount++;
                }
            });

            // Update UI
            if (document.getElementById('total-students')) {
                document.getElementById('total-students').textContent = students.length;
            }
            if (document.getElementById('independent-readers')) {
                document.getElementById('independent-readers').textContent = independentCount;
            }
            if (document.getElementById('instructional-readers')) {
                document.getElementById('instructional-readers').textContent = instructionalCount;
            }
            if (document.getElementById('frustration-readers')) {
                document.getElementById('frustration-readers').textContent = frustrationCount;
            }
        }

        // Call this function on page load and after any data change
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboardStats();
        });

        // After adding/deleting assessment or student, call updateDashboardStats()
        // ...existing code...
    </script>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Get students and assessments from localStorage (same as assessment.html)
    const STUDENTS_KEY = 'grade5ReadingTracker_students';
    const ASSESSMENTS_KEY = 'grade5ReadingTracker_assessments';
    const students = JSON.parse(localStorage.getItem(STUDENTS_KEY)) || [];
    const assessments = JSON.parse(localStorage.getItem(ASSESSMENTS_KEY)) || [];

    // Helper: Get latest assessment for each student
    function getLatestAssessments() {
        const latest = {};
        assessments.forEach(a => {
            if (!latest[a.studentId] || new Date(a.date) > new Date(latest[a.studentId].date)) {
                latest[a.studentId] = a;
            }
        });
        return latest;
    }

    // Helper: Get initials from name
    function getInitials(name) {
        return name.split(' ').map(w => w[0]).join('').toUpperCase();
    }

    // Update Top Readers and Students Needing Support lists
    function updateStudentLists() {
        const latest = getLatestAssessments();

        // Top Readers: Independent level, sorted by highest WR+Comp
        const topReaders = students
            .map(s => ({ student: s, assessment: latest[s.id] }))
            .filter(obj => obj.assessment && obj.assessment.readingLevel === 'Independent')
            .sort((a, b) => ((b.assessment.wordRecognition + b.assessment.comprehension) - (a.assessment.wordRecognition + a.assessment.comprehension)))
            .slice(0, 3);

        // Students Needing Support: Frustration level, sorted by lowest WR+Comp
        const needingSupport = students
            .map(s => ({ student: s, assessment: latest[s.id] }))
            .filter(obj => obj.assessment && obj.assessment.readingLevel === 'Frustration')
            .sort((a, b) => ((a.assessment.wordRecognition + a.assessment.comprehension) - (b.assessment.wordRecognition + b.assessment.comprehension)))
            .slice(0, 3);

        // Render Top Readers
        const topReadersList = document.querySelector('.card:has(.card-header:contains("Top Readers")) .list-group');
        if (topReadersList) {
            topReadersList.innerHTML = '';
            topReaders.forEach(obj => {
                topReadersList.innerHTML += `
                    <div class="list-group-item d-flex align-items-center">
                        <div class="student-avatar">${getInitials(obj.student.name)}</div>
                        <div class="flex-grow-1">
                            <h6 class="mb-0">${obj.student.name}</h6>
                            <small class="text-muted">Word Recognition: ${obj.assessment.wordRecognition}% | Comprehension: ${obj.assessment.comprehension}%</small>
                        </div>
                        <span class="reading-level level-independent">Independent</span>
                    </div>
                `;
            });
        }

        // Render Students Needing Support
        const supportList = document.querySelector('.card:has(.card-header:contains("Students Needing Support")) .list-group');
        if (supportList) {
            supportList.innerHTML = '';
            needingSupport.forEach(obj => {
                supportList.innerHTML += `
                    <div class="list-group-item d-flex align-items-center">
                        <div class="student-avatar">${getInitials(obj.student.name)}</div>
                        <div class="flex-grow-1">
                            <h6 class="mb-0">${obj.student.name}</h6>
                            <small class="text-muted">Word Recognition: ${obj.assessment.wordRecognition}% | Comprehension: ${obj.assessment.comprehension}%</small>
                        </div>
                        <span class="reading-level level-frustration">Frustration</span>
                    </div>
                `;
            });
        }
    }

    // Call on page load
    updateStudentLists();
});
</script>
</body>
</html>